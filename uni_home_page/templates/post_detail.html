{# Ortak ÅŸablon olan base.html'i miras alÄ±r (navbar/footer vb.) #}
{% extends "base.html" %}

{# Static dosyalarÄ± (CSS/JS/img) kullanmak iÃ§in yÃ¼klenir #}
{% load static %}

{# localtime filtresi gibi timezone iÅŸlemleri iÃ§in tz taglerini yÃ¼kler #}
{% load tz %}

{# Sayfa baÅŸlÄ±ÄŸÄ±nÄ± dinamik olarak post baÅŸlÄ±ÄŸÄ± ile belirler #}
{% block title %}{{ post.title }} | UniNews{% endblock %}

{# Bu sayfaya Ã¶zel CSS dosyalarÄ±nÄ± eklemek iÃ§in kullanÄ±lan blok #}
{% block extra_css %}
    {# Post detay sayfasÄ±na Ã¶zel stil dosyasÄ± #}
    <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock %}

{# SayfanÄ±n ana iÃ§erik bloÄŸu #}
{% block content %}

{# KullanÄ±cÄ± admin/staff ise yÃ¶netici Ã¶nizleme panelini gÃ¶ster #}
{% if user.is_staff %}
    <!-- YÃ¶neticiye Ã¶zel hÄ±zlÄ± onay/red/dÃ¼zenle alanÄ± -->
    <div class="dash-card" style="margin-bottom:16px;">
        <strong>ğŸ›  YÃ¶netici Ã–nizlemesi</strong>

        <div style="margin-top:8px;">

            <!-- Post durumunu insan okunur ÅŸekilde gÃ¶sterir (choices display) -->
            <span class="badge-chip">
                Durum: {{ post.get_status_display }}
            </span>

            {# Post beklemede ise onayla/ret aksiyon butonlarÄ± gÃ¶ster #}
            {% if post.status == "PENDING" %}
                <!-- Admin onay action linki -->
                <a href="{% url 'admin_approve_post' post.pk %}" class="btn-primary-custom btn-xs">
                    Onayla
                </a>
                <!-- Admin red action linki -->
                <a href="{% url 'admin_reject_post' post.pk %}" class="btn-outline btn-xs">
                    Reddet
                </a>
            {% endif %}

            <!-- Admin dÃ¼zenleme sayfasÄ±na giden link -->
            <a href="{% url 'admin_edit_post' post.pk %}" class="btn-outline btn-xs">
                DÃ¼zenle
            </a>
        </div>
    </div>
{% endif %}

<!-- SayfayÄ± iki kolonlu dÃ¼zende gÃ¶steren ana kapsayÄ±cÄ± (sol iÃ§erik + saÄŸ sidebar) -->
<div class="page-two-column">

  <!-- Sol taraf: post iÃ§eriÄŸi -->
  <section>

    <!-- Post Ã¼st alanÄ± (kapak + rozetler + baÅŸlÄ±k + yazar/tarih) -->
    <div class="post-hero">

      {# Postun kapak gÃ¶rseli varsa gÃ¶ster, yoksa boÅŸ placeholder gÃ¶ster #}
      {% if post.cover %}
        <!-- Kapak gÃ¶rselinin URL'ini modelin cover field'Ä±ndan alÄ±r -->
        <img class="post-cover" src="{{ post.cover.url }}" alt="">
      {% else %}
        <!-- Kapak yoksa tasarÄ±m bozulmasÄ±n diye boÅŸ alan -->
        <div class="post-cover post-cover--empty"></div>
      {% endif %}

      <!-- Post kategorisi + durum rozetleri -->
      <div class="post-hero-meta">

        <!-- Kategori adÄ±nÄ± choices display ile insan okunur gÃ¶sterir -->
        <span class="badge-chip">{{ post.get_category_display }}</span>

        {# Post status alanÄ± doluysa durum rozetini gÃ¶ster #}
        {% if post.status %}

          {# Status'e gÃ¶re rozet rengi/yazÄ±sÄ± deÄŸiÅŸir #}
          {% if post.status == "PENDING" %}
            <span class="badge-chip badge-warn">Onay Bekliyor</span>
          {% elif post.status == "REJECTED" %}
            <span class="badge-chip badge-danger">Reddedildi</span>
          {% elif post.status == "APPROVED" %}
            <span class="badge-chip badge-ok">OnaylandÄ±</span>
          {% endif %}

        {% endif %}
      </div>

      <!-- Post baÅŸlÄ±ÄŸÄ± -->
      <h1 class="post-title">{{ post.title }}</h1>

      <!-- Yazar kullanÄ±cÄ± adÄ± + oluÅŸturulma tarihi -->
      <div class="post-sub">
        <!-- YazarÄ± @username formatÄ±nda gÃ¶sterir -->
        <span class="post-author">@{{ post.author.username }}</span>

        <!-- KÃ¼Ã§Ã¼k ayraÃ§ nokta -->
        <span class="dot">â€¢</span>

        <!-- created_at alanÄ±nÄ± localtime ile yerel saate Ã§evirip formatlar -->
        <span class="post-date">{{ post.created_at|localtime|date:"d.m.Y H:i" }}</span>
      </div>
    </div>

    {# Ã–zet varsa (summary) Ã¶zet metnini gÃ¶sterir #}
    {% if post.summary %}
      <p class="post-summary">{{ post.summary }}</p>
    {% endif %}

    <!-- Post ana iÃ§erik alanÄ± -->
    <article class="post-content">
      {# content iÃ§indeki satÄ±r sonlarÄ±nÄ± <p>/<br> gibi HTML'e Ã§evirir #}
      {{ post.content|linebreaks }}
    </article>

    <!-- Like/yorum istatistikleri + like butonu -->
    <div class="post-actions">

      <!-- Sol: sayÄ±sal istatistikler -->
      <div class="post-stats">
        <!-- Like sayÄ±sÄ± -->
        <span>â¤ï¸ {{ like_count }}</span>
        <span class="dot">â€¢</span>
        <!-- Yorum sayÄ±sÄ±: comments listesi uzunluÄŸu -->
        <span>ğŸ’¬ {{ comments|length }}</span>
      </div>

      <!-- SaÄŸ: beÄŸenme butonlarÄ± -->
      <div class="post-buttons">

        {# KullanÄ±cÄ± giriÅŸ yaptÄ±ysa like formu gÃ¶ster #}
        {% if user.is_authenticated %}

          <!-- Like toggle endpoint'ine POST atar (beÄŸen/beÄŸeniyi kaldÄ±r) -->
          <form method="post" action="{% url 'toggle_like' post.pk %}">
            {% csrf_token %}
            <button class="btn-secondary-custom btn-sm" type="submit">
              {# liked boolean'Ä±na gÃ¶re buton yazÄ±sÄ±nÄ± deÄŸiÅŸtirir #}
              {% if liked %}BeÄŸenildi{% else %}BeÄŸen{% endif %}
            </button>
          </form>

        {% else %}
          <!-- GiriÅŸ yapmayan kullanÄ±cÄ±yÄ± login sayfasÄ±na yÃ¶nlendirir -->
          <a class="btn-secondary-custom btn-sm" href="{% url 'login' %}">BeÄŸenmek iÃ§in giriÅŸ yap</a>
        {% endif %}

      </div>
    </div>

    <!-- Yorumlar kartÄ± -->
    <div class="dash-card" style="margin-top:16px;">
      <h3>Yorumlar</h3>

      {# GiriÅŸ yapan kullanÄ±cÄ± yorum yazabilsin #}
      {% if user.is_authenticated %}

        <!-- Yorum ekleme formu (POST) -->
        <form class="comment-form" method="post" action="{% url 'add_comment' post.pk %}">
          {% csrf_token %}

          <!-- Yorum metni textarea -->
          <textarea name="text" rows="3" class="form-control-custom" placeholder="Yorum yaz..."></textarea>

          <!-- GÃ¶nder butonu -->
          <button class="btn-primary-custom btn-sm" type="submit">GÃ¶nder</button>
        </form>

      {% else %}
        <!-- GiriÅŸ yapmayan kullanÄ±cÄ±ya uyarÄ± -->
        <div class="alert-custom alert-info">Yorum yapmak iÃ§in giriÅŸ yapmalÄ±sÄ±n.</div>
      {% endif %}

      <!-- Yorum listesi -->
      <div class="comment-list">

        {# comments iÃ§indeki her yorumu tek tek basar #}
        {% for c in comments %}

          <!-- Tek yorum kutusu -->
          <div class="comment-item">
            <div class="comment-top">

              <!-- Yorumu yazan kullanÄ±cÄ± -->
              <strong>@{{ c.user.username }}</strong>

              <!-- Yorum tarihi: localtime + format -->
              <span class="comment-date">{{ c.created_at|localtime|date:"d.m.Y H:i" }}</span>
            </div>

            <!-- Yorum metni: satÄ±r sonlarÄ±nÄ± <br> yapar -->
            <div class="comment-text">{{ c.text|linebreaksbr }}</div>
          </div>

        {% empty %}
          <!-- HiÃ§ yorum yoksa gÃ¶sterilecek mesaj -->
          <p class="muted">HenÃ¼z yorum yok.</p>
        {% endfor %}

      </div>
    </div>

  </section>

  <!-- SaÄŸ taraf: sidebar -->
  <aside>
    <section class="side-card">
      <h3>HÄ±zlÄ± Ä°ÅŸlemler</h3>

  {% if request.user.is_staff %}
    <!-- Admin dashboard'a dÃ¶nÃ¼ÅŸ linki -->
    <a class="btn-outline btn-block" href="{% url 'admin_dashboard' %}">
      Admin Paneline DÃ¶n
    </a>
  {% endif %}

      <!-- Ana sayfaya dÃ¶nÃ¼ÅŸ linki -->
      <a class="btn-outline btn-block" href="{% url 'home' %}">Ana Sayfa</a>
    </section>
  </aside>

</div>

{# content bloÄŸu biter #}
{% endblock %}
